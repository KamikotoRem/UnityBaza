# Работа #3 - Механика тряпичной куклы в Unity
Отчет по лабораторной работе #3 выполнил(а):
- Захаров Данил Андреевич
- РИ-320930
- АТ-01
# Цель работы: освоить создание тряпичной куклы Ragdoll на движке Unity

![image](https://github.com/user-attachments/assets/b2018663-07da-473c-b498-3f5f94fa8b2e)

Рекомендуемые источники для изучения:
1.	Collider Unity Documentation
2.	Тема Ragdoll в материалах лекции

# Задания к работе
# Задание 1 Создание механики тряпичной куклы
1.1 Скачайте любую Humanoid-модель с сайта Mixamo.com в формате FBX for Unity. Можете выбрать сразу модель с анимацией, либо скачать анимацию позднее:

![image](https://github.com/user-attachments/assets/fcb447aa-2818-4765-9501-d53a46e44dee)

1.2 Добавьте модель в проект и на сцену Unity. Работает простое перетаскивание скачанной модели сначала в папку Project Unity, и далее – на сцену.

1.3 При добавлении на сцену модель будет белого цвета. Это происходит из-за отсутствия текстур. Текстуры в файле .fbx есть, но их нужно извлечь, для этого кликните по .fbx файлу и в окне Inspector выбираем Materials - Extract Textures. Появляется окно «Normal Map Settings» - нажимаем «Fix Now». Здесь выводится информация о том, что нужно правильно интерпретировать настройки карт нормали.

## Скачал, добавил Humanoid-модель на сцену и извлёк текстуры

![image](https://github.com/user-attachments/assets/bab755b0-027e-43c9-9386-5b0881cccd62)

1.4 В окне Hierarchy развернем персонажа: ALT (Option) + CLICK по нему. Так будут развернуты все вложенности. Чтобы сделать Ragdoll, нужно выделить каждую часть тела и назначить на нее серию компонентов: Rigidbody + Collider + Joint (шарнир). Для того чтобы сделать это в автоматическом режиме перейдите во вкладку GameObject -> 3D Object -> Ragdoll (инструмент создания тряпичной куклы).

## Окно иерархии персонажа

![image](https://github.com/user-attachments/assets/acd79064-6428-44bd-a111-15af624e38d0)


1.5 Открывается окно со слотами, которое нужно наполнить частями тела персонажа (перетаскиванием из окна Hierarchy в окно Create Ragdoll). На те части, которых нет в списке - Rigidbody не назначается. В нижней части указывается Total Mass - вес тела, который будет распределен между всеми частями, пропорционально их размерам. Например, в нашем случае ставим вес тела 60 кг:

![image](https://github.com/user-attachments/assets/1229a453-1fff-4078-9802-f3283c15b702)


1.6 Завершите создание тряпичной куклы, подтвердив действие в окне Create Ragdoll. Если выделить самый верх иерархии (в окне Hiararchy) персонажа - то вы увидите автоматически созданные коллайдеры:

## Автоматически созданные коллайдеры

![image](https://github.com/user-attachments/assets/07dfd338-59ee-4b30-a2a3-4ecebac734fd)

1.7 Запустите сцену. Что не так с механикой? Внесите исправления в автоматически назначенные компоненты, чтобы механика падения тряпичной куклы выглядела более натурально. Дайте развернутый ответ, что требовалось исправить:

-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Ноги персонажа резко разъезжались в стороны из-за больших размеров коллайдера (они соприкасались друг с другом, из-за чего происходило резкое выталкивание одного коллайдера из пространства другого). Изменил радиус коллайдера у объектов, относящихся к ногам (mixamorig1:LeftUpLeg, mixamorig1:LeftLeg, mixamorig1:RightUpLeg, mixamorig1:RightLeg).

## Изменённый радиус у коллайдера ноги

![image](https://github.com/user-attachments/assets/9e418b0f-42fe-4506-a80a-b0f30aa06c6c)


-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

# Задание 2 Переход между Ragdoll и анимацией персонажа

1.8 Скачайте с сайта Mixamo скелет с анимацией какого-либо движения (если не сделали этого ранее). И добавьте в проект Unity (перетаскиванием в окно Project). Разверните скачанный файл (нажав стрелку рядом с моделью). Файл с анимацией выглядит как треугольник. Извлеките его из пакета, нажав Ctrl+D. Выберите извлеченный файл анимации и сделай так, чтобы она была зациклена (клик Loop Time в окне Inspector)

![image](https://github.com/user-attachments/assets/cc3e628a-1025-4033-b15a-2365d700a1bf)

## пакет анимации

![image](https://github.com/user-attachments/assets/47f94df0-d3f7-4614-a56f-16cd9c9f5d50)


1.9 Правильный порядок создания анимации выглядит так:
-	создайте контроллер анимации (клик ПКМ в окне Project - Create - Animator Controller)
-	созданный Animator Controller назначьте на модель персонажа на сцене
-	откройте созданный контроллер анимации (дважды кликнув по нему)
-	переместите анимацию из предыдущего пункта в контроллер анимации

![image](https://github.com/user-attachments/assets/1386fb5a-3b2d-4930-94ac-2a1298127540)

## Назначил созданный контроллер анимации на персонажа

![image](https://github.com/user-attachments/assets/29d144ef-a474-4bb3-b54b-cf5b3f3ba671)


## Открыл созданный контроллер анимации и переместил анимацию из предыдущего пункта в него

![image](https://github.com/user-attachments/assets/3e220312-2f67-45c5-a53b-94c720bb64dc)


1.10  При запуске сцены анимация в вашем случае выглядит забагованной. Как вы считаете, почему это происходит? Дайте развернутый ответ:

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
**Без понятия...**

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
1.11 Создадим скрипт файл RagdollControl.cs, который будет отключать анимацию и включать механику тряпичной куклы. Описание скрипта: 
-	Скрипт RagdollControl.cs навешивается на персонажа. Скрипт будет содержать две переменные: 
-	Animator для управления анимацией
-	Массив Rigidbodies, который будет отключаться
-	Когда скрипт будет написан и подключен, в поле переменной Animator подключается Animator в пределах поля Inspector.
-	Массив All Rigidbodies нужно заполнить всеми rigid bodies модели: чтобы это сделать удобно нужно нажать замок на инспекторе персонажа. 
-	 В окне иерархии выделить все внутренности персонажа (через shift) и перетащить на массив в инспекторе.
-	Так будут добавлены все rigidbodies этого персонажа.

Содержание скрипта, отключающего анимацию показано ниже:

```C#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class ScriptRagdollOff : MonoBehaviour
{
    public Animator animator;
    public Rigidbody [] allRigidbodies;

    private void Awake()
    {
        for (int i = 0; i < allRigidbodies.Length; i++)
        {
            allRigidbodies[i].isKinematic = true;
        }
    }

    void Update()
    {
        if (Input.GetKeyDown(KeyCode.Space))
        {
            MakePhysics();
        }
    }

    public void MakePhysics()
    {
        animator.enabled = false;
        for (int i = 0; i < allRigidbodies.Length; i++)
        {
            allRigidbodies[i].isKinematic = false;
        }
    }
}
```

## Создал скрипт RigdollControl, применил его на персонаже и добавил в массив нужные части персонажа

![image](https://github.com/user-attachments/assets/761e706f-c5f6-4ada-b87b-8b32fd2abd68)


1.12 Что произойдет, если не все Rigidbody тряпичной куклы будут отключены? Дайте развернутый ответ.

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Eсли не все Rigidbody тряпичной куклы будут отключены, то те части, у которых Rigidbody не будут отключены, продолжат отыгрывать анимацию, а те, у которых Rigidbody отключён – перестанут двигаться и будут просто болтаться за теми частями, которые до сих пор находятся в движении.
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

1.12 Напишите развернутый вывод по проделанной работе. Как знания свойств компонентов Collider помогут в создании интерактивных приложений, игр и симуляторов?

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
В ходе данной лабораторной работы были изучены основные способы работы с таким компонентом как Ragdoll. Также была проведена работа по скачиванию и добавлению 3D-моделей и их анимаций в проект Unity. С помощью скрипта была настроена функция включения Ragdoll’а по нажатию указанной клавиши. В дальнейшем данные знания могут помочь в создании различных механик, например, включение какой нибудь анимации при пересечение коллайдеров.
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
